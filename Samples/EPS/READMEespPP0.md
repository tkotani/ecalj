* 誘電関数の計算方法 2025-5-8
```
epsPP0 gaas -np 8
```
などとして実行してください。実行前にGWinputに
```
QforEPSau on
<QforEPS>
 0 0 0.0005
 0 0 0.001
 0 0 0.002
</QforEPS>
```
と３つのqで計算する設定にしてあるのを確認してください。
この3つのグラフが重なっていればq=0での計算ができています。
いくつかのq~0で計算してq=0とみなしていいことを確認します。
```
gnuplot -p epsinter.glt
```
で描画できます。

** QforEPSau on
これはQforEPSのqをa.u.ではかるという意味になります。
たとえば<QforEPS>に0d0 0d0 0.00005とあれば、これは
q=(0d0 0d0 0.00005)/bohrと読んでください。
（過去のQforEPSunita on と同じ意味）。
確認するには,2pi/alatをEPSファイル最初の3つの数字に乗じて
<QforEPS>にかかれているqになるのをみます。

** 以前の--zmel0のオプションは2025-5-8で廃止しました。
これはGramSchmidt2をsugw.f90に挿入して
すこし正確な直行化が可能になったためです。

** epsPP0では最後にreadeps.pyを読んでて答えをまとめ上げてます。

** qがあまりにゼロに近いと計算が不安定です。たとえば
QforEPSau on 
<QforEPS>
 0d0 0d0 0.00005
 0d0 0d0 0.0001
 0d0 0d0 0.0002
 0d0 0d0 0.0004
 0d0 0d0 0.0008
 0d0 0d0 0.0016
 0d0 0d0 0.0032
</QforEPS>
などとすると、 0d0 0d0 0.00005のグラフがおかしいです。
それ以外のグラフはほぼ重なります。だた、0.0032ぐらいになるとomega=0での実部がいくらかずれてきます。


** CuepsPP0ではフェルミ面の寄与もあり、
>gnuplot -p epsintra.glt
を実行してフェルミ面の寄与が見れます。ドルーデウエイトですが、q分解でみれています。
omega=0近傍でのふるまいはFetter-Waleckaにあるようにふるまっています。
```
gnuplot -p epsintra.glt
gnuplot -p epsall.glt
```

** epsPP0の最後にreadeps.pyが取りまとめてくれるので（汚いので書き直したほうがいい）、


** （改良計画）誘電関数計算にはバンド吸収端で(E-E0)**.5でキレイに立ち上がらない(GaAsなどの場合）、
という数値計算上の問題があります。メッシュを細かく取るときれいにできることは示したことがあります。
変な内挿法よりも必要なことだけ細かく取るという技法が有効だと思います。汎用化しないといけないです。

**（改良計画）q=0でのinterbandの寄与は<u|u>行列を使えば先に1/q^2の割り算ができるので
もっと直接的にできるはずです。

---------- end of 2025-5-8 --------------




=======================================================
* OLD document before 2025-5-7

誘電関数ｑ＝０を計算するには、最近のバージョンの（２０２３−１０−２３以後）の
収束したところからスクリプトepsPP0を使ってください。
ecalj/MATERIALS/Cueps
にサンプルがあるので、Cuを収束させた後、
epsPP0 cu -np 4
などとすると、epsinter.glt, epsintra.glt, epsall.glt
ができます。epsintraはフェルミ面の寄与になります。

いくつかのｑ点で計算してｑ＝＞０を取るのです。そのためにctrlには
ーーーーーーーーーーーーーーーーーー
QforEPSunita on
<QforEPS>
 0d0 0d0 0.00001
 0d0 0d0 0.001
 0d0 0d0 0.0014142
 0d0 0d0 0.002
 0d0 0d0 0.0028284
 0d0 0d0 0.004
</QforEPS>
ーーーーーーーーーーーーーーーーーー
などと書いておく必要があります。


最低でも、2行入ります。
QforEPSunita on
<QforEPS>
 0d0 0d0 0.00001
 0d0 0d0 0.001
</QforEPS>
ーーーーーーーーーーーーーーーーーー
が、いります.できれば後何行かあったほうがいいです。

QforEPSunita onは単位を2pi/alat　とする指定です。
最初の行の0d0 0d0 0.00001　は数値誤差を計算するためにいるんです。

 0d0 0d0 0.001での誘電関数計算にも 0d0 0d0 0.00001で計算した行列要素（誤差の大きさを計算）を使うんです。なので、EPS0002以後が意味のある答えになります。
epsinter.gltなどではqを複数計算して重ねてみています。
Cuだとキレイにかさなっているのが見て取れます。

epsPP0では最後にreadeps.pyを読んでて答えをまとめ上げてます。
（readeps.py汚いです。試行錯誤の結果が残っていて関数fd0はいまは使っていません）。
いぜんよりはだいぶとキレイに求まると思います。

Ag、結果がこれでも変なら教えてください。

================================================================================
