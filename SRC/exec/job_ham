#!/bin/bash -eux
nfpgw=`dirname $0`
echo $0
echo $@
echo $1
if [ $# -le 2 ] || [ $2 != "-np" ]; then
  echo "An example of usage: job_ham si -np 4 [options for lmf]"
  exit
else
  MPI_SIZE=$3
fi
rm -f HamiltonianPMT*
echo 'Runnnig Hamiltonian generation'
mpirun -np $3 $nfpgw/lmf-MPIK $1 --writeham --mkprocar --fullmesh >& out_writeham
# Get Hamiltonian file, namded as HamiltonianMTO
cat HamiltonianPMT.* >HamiltonianPMT
rm HamiltonianPMT.* 
# Get |MTP> Get MTprojected Hamiltonian
mpirun -np $3 $nfpgw/lmfham1 $1 >& out_lmfham1

# Get |MLO> Get MLO Hamiltonian
#$nfpgw/lmfham2 --job=0 >& out_lmfham2_0
#$nfpgw/lmfham2 --job=1 >& out_lmfham2_1
echo 'OK! end of job_ham. '
echo  'Run lmfham2 --job=0 and lmfham2 --job=1 after edit GWinput'

